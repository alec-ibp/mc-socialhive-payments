# MC Payments API

![FastAPI](https://img.shields.io/badge/FastAPI-0.68.1-blue)
![Python](https://img.shields.io/badge/Python-3.9.7-green)
![Redis](https://img.shields.io/badge/Redis-6.2.5-red)
![Docker](https://img.shields.io/badge/Docker-20.10.8-blue)

This is a Python microservice example that provides a API for managing a mock payment process with redis streams and message bus architecture. The API is built using the FastAPI framework and uses Redis as a data store and event broker.

## Getting Started

To get started with this project, you'll need to have Python 3.9 or later installed on your system. You'll also need to install the project dependencies using pip:

```
pip install -r requirements.txt
```

or with poetry (i recommend it):
```
poetry install
```

Once you have the dependencies installed, you can start the API server by running the following command:

```
python main.py
```

This will start the API server on `http://0.0.0.0:9090`.

You can also run the project using Docker and Docker Compose.

```
docker-compose up
```

To build the docker image

```
docker build -t <docker-image-name>:<version/latest> .
```

## Environment Variables

The following environment variables can be used to configure the application:

- `DEBUG`: Set to `1` to enable debug mode. Defaults to `0`.
- `CORS_ALLOWED_METHODS`: A comma-separated list of HTTP methods that are allowed for CORS requests. Defaults to `"*"`.
- `CORS_ALLOWED_HEADERS`: A comma-separated list of HTTP headers that are allowed for CORS requests. Defaults to `"*"`.
- `CORS_ALLOWED_HOSTS`: A comma-separated list of hosts that are allowed for CORS requests. Defaults to an empty string.
- `REDIS_HOST`: The hostname or IP address of the Redis server. Defaults to `"redis"`.
- `REDIS_PASSWORD`: The password to use when connecting to the Redis server. Defaults to an empty string.
- `REDIS_PORT`: The port number to use when connecting to the Redis server. Defaults to `6379`.
- `BASE_PAYMENTS_API`: The base URL of the payments microservice API. Defaults to `"http://payments_web:9090"`.

You can set these environment variables using a `.env` file in the root directory of the project. The `.env` file should have the following format:

```properties
DEBUG=1
CORS_ALLOWED_METHODS="*"
CORS_ALLOWED_HEADERS="*"
CORS_ALLOWED_HOSTS=""
REDIS_HOST="redis"
REDIS_PASSWORD=""
REDIS_PORT=6379
BASE_PAYMENTS_API="http://payments_web:9090"
```

Note that the `REDIS_HOST` environment variable is set to `"redis"` by default, which assumes that you are using Docker Compose to run the application. If you are running the application outside of Docker Compose, you may need to set this variable to the hostname or IP address of your Redis server.

## API Endpoints

The following API endpoints are available:
GitHub Copilot: Sure, here's the documentation for the two API endpoints in markdown format:

### `POST /`

Create a new payment order.

##### Request Body

```json
{
  "id": "string",
  "amount": 0,
  "currency": "string",
  "description": "string"
}
```

##### Response Body

```json
{
  "id": "string",
  "amount": 0,
  "currency": "string",
  "description": "string",
  "status": "string"
}
```

This endpoint creates a new payment order with the specified `id`, `amount`, `currency`, and `description`. The `status` of the payment order is initially set to `"created"`. The endpoint returns the newly created payment order with the `id`, `amount`, `currency`, `description`, and `status` fields.

### `GET /{order_id}`

Get an existing payment order.

##### Path Parameters

- `order_id` - The ID of the payment order to retrieve.

##### Response Body

```json
{
  "id": "string",
  "amount": 0,
  "currency": "string",
  "description": "string",
  "status": "string"
}
```

This endpoint retrieves an existing payment order with the specified `order_id`. The endpoint returns the payment order with the `id`, `amount`, `currency`, `description`, and `status` fields.
## Autogenerated Docs

The API documentation is autogenerated and can be accessed by visiting `http://0.0.0.0:8080/docs` or `http://0.0.0.0:8080/redoc` in your web browser (if you are in DEBUG mode). The documentation provides detailed information about each endpoint, including the request and response schemas, query parameters, and example requests and responses.